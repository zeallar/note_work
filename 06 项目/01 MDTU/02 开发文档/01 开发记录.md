## 1、联网

将mqtt_test.c文件中的

```C
#define APN_NAME   "3GNET"
#改为
#define APN_NAME   "CMNET"
```

# 2、添加cjson库的报错

[下载地址](https://sourceforge.net/projects/cjson/)

找不到pow和floor函数，[解决方法](https://blog.csdn.net/loushuishizhong/article/details/96483208)。

# 3、创建json对象

```C
create_json_object(){
	cJSON *root,*fmt;char* out;

	root=cJSON_CreateObject();	
	cJSON_AddItemToObject(root, "name", cJSON_CreateString("Jack (\"Bee\") Nimble"));
	cJSON_AddItemToObject(root, "format", fmt=cJSON_CreateObject());
	cJSON_AddStringToObject(fmt,"type",		"rect");
	cJSON_AddNumberToObject(fmt,"width",		1920);
	cJSON_AddNumberToObject(fmt,"height",		1080);
	cJSON_AddFalseToObject (fmt,"interlace");
	cJSON_AddNumberToObject(fmt,"frame rate",	24);
	
	out=cJSON_Print(root);	cJSON_Delete(root);	printf("%s\n",out);	free(out);	/* Print to text, Delete the cJSON, print it, release the string. */
```

![image-20231007143946315](01 开发记录.assets/image-20231007143946315.png)



# bug

1、主线程中执行发布和订阅失败

解决方法：引入线程池执行发布和订阅，并将耗时任务用线程执行。

mqtt  yield方法保持激活

### 工作进度核对

2023/10/13 已完成的工作，核对已完成工作

1. 逻辑简单介绍，考量可行性
2. 遇到的问题，咨询解决方法

待完成的工作，核对待完成工作思路

1. 代码重构
2. 逻辑优化
3. 冗余代码剥离
4. 功能调整
5. 加本地串口

### 正在进行的工作

**完善task**

1、代码重构mqtt和tcp server getinfo extract，改makefile。[参考](https://gitlab.qiot.cn:8051/embed/simcom/a7608e/es5020)

- 创建目录结构 :ok:
- 修改makefile :ok:
- 代码重构
  - 分析es5020代码逻辑 :ok:
  - 重构自己代码 :ok:

2、网络重连，看门狗实现。回调判断网络是否激活成功；尝试mqtt连接，若连接失败继续休眠。:clock3:...

3、get不到的信息用at命令拿，参考`E:\L716\L716-EU-10\软件\通用\FIBOCOM L716-CN-50 AT Commands_V1.0.0.pdf`:clock4:...//用软件接口试试，at客户端无效

**功能task**

3、解决网络断连和snmp的冲突。

4、log函数实现  :ok:

**5**、执行shell命令功能，并返回结果。如ls命令 :ok:

**6**、本地usb接口通讯

7、tcp server 通讯

8、统一变量类型 uint/int

9、添加备注

10、修改信号处理函数

11、扩展信息从配置文件中拿:ok:

**12**、get 6.移植ntp:ok:

13、规范文件名称

14、set方法实现:clock5:

15、ntp 配置信息从配置文件中拿:ok:

16、配置文件读写实现:ok:

17、set修改后重启相应服务

**18**、修改系统时区；调用cron接口每1个小时同步1次；若主服务器地址同步失败，调用次服务器地址同步。:clock6:

##### **现存问题**

1、部分at命令无效，或者找不到对于at命令

2、本地usb通讯硬件接线方法



2023/10/18 **已知bug**

bug1

bug出现情况：压力测试下(连续遍历50次getinfo)

bug描述：在第二遍或者第三遍的时候会读取信息失败

![image-20231018145242814](01 开发记录.assets/image-20231018145242814.png)

bug2

退出很慢

## 配置

ntp时区配置文件

![image-20231020171011217](01 开发记录.assets/image-20231020171011217.png)

ntp流程图

![jpeg](01 开发记录.assets/.jpeg)
